---
title: Progressive Image Loading
nav_order: 19
parent: Malibu Tutorial
---

# {{page.title}}

_This tutorial was contributed by [Harshith](https://www.linkedin.com/in/harshith-raj-092ba4176) and [Nandakishore Prakash Rao](https://twitter.com/nkp_adm)_

# Progressive Image Loading

Images form an important asset for an application. Nearly 50% of a typical pageâ€™s weight is made up of images, optimizing images is extremely important for running a performant site. To solve this issue, we have implemented progressive image loading.

**What is progressive image loading?**

Images load immediately on your website at first with a low resolution and then increase their resolution as the website loads completely. This is achieved by a couple of parameters supported by Gumlet - sizes and blur.

**How to implement it on your app?**

If your app is cloned from Malibu/Malibu advanced:

Go to the `views/pages/layout.ejs` file, modify the gumlet config by adding `srcset: true`. This will enable the srcset and the image will be rendered from one among the srcsets generated by Gumlet.

```html
<script type="text/javascript">
  window.GUMLET_CONFIG = {
    ...
    ...
    srcset: true,
  };
</script>
```

Go to the BlackKnight and add the config to set corresponding values in `app/config/publisher.yml`:

```yaml
progressive_image:
  is_enable: true
  transition_timeout: 2500
  initial_load:
    blur: 0
    generic_size: "3vw"
    story_page_size: "10vw"
  subsequent_load:
    blur: 0
    generic_size: "25vw"
    story_page_size: "50vw"
```

| Key                | Type    | Description                                                                                                                                           |
| ------------------ | ------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- |
| progressive_image  | object  | Contain keys related to progressive image loading                                                                                                     |
| is_enable          | boolean | Toggle to enable or disable progressive image loading                                                                                                 |
| transition_timeout | number  | The time taken to render a high-resolution image from a low-resolution image (in milliseconds)                                                        |
| initial_load       | object  | Contain keys for loading the low-resolution image                                                                                                     |
| subsequent_load    | object  | Contain keys for loading the higher resolution of the image                                                                                           |
| blur               | number  | This will blur out the image from a range of 0 to 100, 0 being no blurred effect and 100 being fully blurred effect                                   |
| generic_size       | string  | This will set the image size for all the pages (in px or vw). Preferred to be in vw so that the size would be determined based on the viewport width. |
| story_page_size    | string  | The sizes can be set for individual pages or any other custom params. The logic for the same needs to be handled in the code.                         |

Here is an example: `app/isomorphic/components/atoms/card-image/index.js`:

```javascript
import React, { useEffect, useState } from "react";
import { get } from "lodash";
import { ResponsiveImage } from "@quintype/components";
import { shape, string, object, bool } from "prop-types";
import { useSelector } from "react-redux";

import "./card-image.m.css";

export const CardImage = ({ story, isInitRow, pageType }) => {
  const progressiveImageConfig = useSelector((state) =>
    get(
      state,
      ["qt", "config", "publisher-attributes", "progressive_image"],
      {}
    )
  );

  const imagePerfObj =
    progressiveImageConfig.is_enable && isInitRow
      ? progressiveImageConfig.initial_load
      : { size: "25vw", blur: 0 };
  const [perfObj, setPerfObj] = useState(imagePerfObj);
  const customStyleName =
    pageType !== "story-page" && !story["hero-image-s3-key"]
      ? "placeholder"
      : "";

  useEffect(() => {
    if (isInitRow && progressiveImageConfig.is_enable) {
      setTimeout(() => {
        setPerfObj(progressiveImageConfig.subsequent_load);
      }, progressiveImageConfig.transition_timeout || 2500);
    }
  }, []);

  const getImageSize = () => {
    if (pageType === "story-page") {
      return perfObj.story_page_size;
    }
    return perfObj.generic_size;
  };

  return (
    <figure
      className="qt-image-16x9"
      styleName={`card-image ${customStyleName}`}
    >
      {story["hero-image-s3-key"] && (
        <ResponsiveImage
          slug={story["hero-image-s3-key"]}
          metadata={story["hero-image-metadata"]}
          aspectRatio={[16, 9]}
          defaultWidth={480}
          widths={[250, 480, 640]}
          sizes={getImageSize()}
          imgParams={{ auto: ["format", "compress"], blur: perfObj.blur }}
          alt={story.headline || ""}
        />
      )}
    </figure>
  );
};

const storyPropType = shape({
  id: string,
  slug: string,
  "hero-image-s3-key": string,
  "hero-image-metadata": object,
  headline: string,
  "author-name": string,
});

CardImage.propTypes = {
  story: storyPropType,
  isInitRow: bool,
  pageType: string,
};
```

Note: `isInitRow` is a prop that returns a boolean value indicating that the progressive image should be applied for the desired number of rows. The condition can be removed, if the progressive image loading is not needed.

Ex: In the file: `app/isomorphic/components/collection-templates/four-col-grid/index.js`:

```javascript
const isInitRow = index === 0 || index === 1;
```

Here, in the above example, the progressive image loading gets applied to the first 2 rows.

If your app is not cloned from Malibu/Malibu advanced:

Wherever the Gumlet config is set, modify the gumlet config by adding `srcset: true`. This will enable the srcset and the image will be rendered from one among the srcsets generated by Gumlet.

```html
<script type="text/javascript">
  window.GUMLET_CONFIG = {
    ...
    ...
    srcset: true,
  };
</script>
```

Then, wherever an image tag is used:

For the initial load of the low resolution image:

```html
<img
  srcset="imgurl?blur=10 1024w, imgurl?blur=10 640w, imgurl?blur=10 480w"
  sizes="10vw"
/>
```

For the subsequent load of the high resolution image:

```html
<img
  srcset="imgurl?blur=0 1024w, imgurl?blur=0 640w, imgurl?blur=0 480w"
  sizes="25vw"
/>
```

The size and the blur value can be varied based on your preference.
